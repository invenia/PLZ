[tox]
envlist =
    check,
    py36,
    py37,
    coverage,
    docker,
    docs

[testenv]
usedevelop = True
extras = test
setenv =
    NODOCKER = 1
    PYTHONPATH = {toxinidir}
    py{36,37}: COVERAGE_FILE=.coverage.{envname}
commands =
    py{36,37}: py.test --cov=plz --verbose --tb=long

[testenv:coverage]
basepython = python3.7
deps = coverage
skip_install = True
skipsdist = True
commands =
    /usr/bin/env bash -c "{envpython} -m coverage combine .coverage.*"
    coverage report
    coverage html

[testenv:docker]
basepython = python3.7
usedevelop = True
extras = test
setenv =
    PYTHONPATH = {toxinidir}
commands =
    py.test --verbose --tb=long ./tests/test_docker_build.py

[testenv:check]
basepython = python3.7
extras = check
commands =
    isort plz tests setup.py docs/conf.py --check-only
    black plz tests setup.py docs/conf.py --check --diff
    flake8 plz tests setup.py docs/conf.py
    mypy plz

[testenv:docs]
basepython = python3.7
extras = docs
commands = sphinx-build {posargs:-E} -b html docs dist/docs
